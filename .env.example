# =============================================================================
# PostgreSQL OpenTelemetry Collector - New Relic Configuration
# =============================================================================

# =============================================================================
# POSTGRESQL DATABASE CONFIGURATION
# =============================================================================

# Primary database connection (choose one method)
# Method 1: Connection string (recommended)
POSTGRES_CONNECTION_STRING=postgresql://postgres:password@localhost:5432/postgres

# Method 2: Individual connection parameters (alternative to connection string)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USERNAME=postgres
POSTGRES_PASSWORD=password
POSTGRES_DATABASE=postgres

# Database list for multi-database monitoring (comma-separated)
POSTGRES_DATABASES=postgres,application_db

# Connection pool settings
POSTGRES_MAX_CONNECTIONS=10
POSTGRES_CONNECT_TIMEOUT_SECS=30

# SSL Configuration (production environments)
POSTGRES_SSLMODE=prefer
# POSTGRES_SSLCERT=/path/to/client.crt
# POSTGRES_SSLKEY=/path/to/client.key
# POSTGRES_SSLROOTCERT=/path/to/ca.crt

# =============================================================================
# NEW RELIC CONFIGURATION
# =============================================================================

# New Relic License Key (required)
NEWRELIC_API_KEY=YOUR_LICENSE_KEY_HERE

# New Relic Region (US or EU)
NEWRELIC_REGION=US

# New Relic OTLP Endpoints (auto-configured based on region)
# US: https://otlp.nr-data.net:4318
# EU: https://otlp.eu01.nr-data.net:4318

# =============================================================================
# COLLECTION CONFIGURATION
# =============================================================================

# Collection interval in seconds
COLLECTION_INTERVAL_SECS=30

# Query monitoring thresholds
QUERY_MONITORING_COUNT_THRESHOLD=100
QUERY_MONITORING_RESPONSE_TIME_THRESHOLD=1000
MAX_SLOW_QUERIES=1000

# Extended metrics
ENABLE_EXTENDED_METRICS=true
ENABLE_ASH=true
ENABLE_EBPF=false

# Active Session History (ASH) configuration
ASH_SAMPLE_INTERVAL_SECS=5
ASH_RETENTION_HOURS=24
ASH_MAX_MEMORY_MB=100

# Query text sanitization
SANITIZE_QUERY_TEXT=true
SANITIZATION_MODE=smart  # none, smart, or full

# =============================================================================
# DIMENSIONAL METRICS CONFIGURATION
# =============================================================================

# Metric export settings
EXPORT_INTERVAL_SECS=30
METRIC_BATCH_SIZE=1000
MAX_CONCURRENT_EXPORTS=2
ENABLE_COMPRESSION=true

# Cardinality control
MAX_QUERY_FINGERPRINTS=10000
MAX_WAIT_EVENTS=100
MAX_USERS=1000
QUERY_TEXT_MAX_LENGTH=1000

# =============================================================================
# OUTPUT CONFIGURATION
# =============================================================================

# OpenTelemetry Protocol (OTLP) output
OTLP_ENABLED=true
OTLP_PROTOCOL=http  # http or grpc
OTLP_COMPRESSION=gzip
OTLP_TIMEOUT_SECS=30

# =============================================================================
# PGBOUNCER MONITORING (OPTIONAL)
# =============================================================================

# PgBouncer integration
PGBOUNCER_ENABLED=false
PGBOUNCER_ADMIN_CONNECTION_STRING=postgresql://pgbouncer:password@localhost:6432/pgbouncer
PGBOUNCER_COLLECTION_INTERVAL_SECS=30

# =============================================================================
# ADVANCED OPTIONS
# =============================================================================

# Service identification
SERVICE_NAME=postgresql
SERVICE_NAMESPACE=production
SERVICE_INSTANCE_ID=${HOSTNAME}:${POSTGRES_PORT}
DEPLOYMENT_ENVIRONMENT=production

# Health check endpoint
HEALTH_CHECK_PORT=8080
HEALTH_CHECK_PATH=/health

# Logging
LOG_LEVEL=info
LOG_FORMAT=json

# Performance tuning
WORKER_THREADS=4
MAX_MEMORY_MB=512
BUFFER_SIZE_MB=64

# =============================================================================
# MULTI-INSTANCE CONFIGURATION (OPTIONAL)
# =============================================================================

# Additional PostgreSQL instances (JSON array)
# POSTGRES_INSTANCES='[
#   {
#     "name": "replica-1",
#     "connection_string": "postgresql://postgres:password@replica1:5432/postgres",
#     "enabled": true
#   },
#   {
#     "name": "analytics-db",
#     "connection_string": "postgresql://postgres:password@analytics:5432/analytics",
#     "enabled": true
#   }
# ]'

# =============================================================================
# CLOUD PROVIDER METADATA (OPTIONAL)
# =============================================================================

# AWS
# CLOUD_PROVIDER=aws
# AWS_REGION=us-east-1
# AWS_ACCOUNT_ID=123456789012
# AWS_INSTANCE_ID=i-1234567890abcdef0

# GCP
# CLOUD_PROVIDER=gcp
# GCP_PROJECT_ID=my-project
# GCP_ZONE=us-central1-a
# GCP_INSTANCE_NAME=postgresql-prod

# Azure
# CLOUD_PROVIDER=azure
# AZURE_SUBSCRIPTION_ID=12345678-1234-1234-1234-123456789012
# AZURE_RESOURCE_GROUP=my-resource-group
# AZURE_VM_NAME=postgresql-prod